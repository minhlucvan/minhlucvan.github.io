<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Minh Luc&#39;s Blog"><title>vi·∫øt m·ªôt ch∆∞∆°ng tr√¨nh cho ph√©p c√†i plugin trong java nh∆∞ th·∫ø n√†o? - Minh Luc&#39;s Blog</title><meta name="author" content="Minh Luc"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Minh Luc","sameAs":["https://github.com/minhlucvan","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/minhlucvan.3","https://plus.google.com/","https://www.linkedin.com/profile/","mailto:luk.mink@gmail.com"],"image":"https://www.buildabear.com/dw/image/v2/BBNG_PRD/on/demandware.static/-/Sites-buildabear-master/default/dwdfa7c1cf/27618_27630_25342_24630x.jpg?sw=600&sh=600&sm=fit&q=70"},"articleBody":"Ch·∫£ l√† ƒëang t·∫≠p t·ªçe l√†m wordpress plugin, b·ªóng d∆∞ng n·∫£y ra c√¢u h·ªèi th·∫ø c√†i ƒë·∫∑t plugin trong java nh∆∞ th·∫ø n√†o. Tr∆∞·ªõc gi·ªù c≈©ng ch·ªâ l√†m theo ki·ªÉu y√™u c·∫ßu ƒë·∫øn ƒë√¢u vi·∫øt ƒë·∫øn ƒë·∫•y ch·ª© ch∆∞a ƒë∆∞·ª£c l√†m ki·ªÉu plugin n√†y bao gi·ªù c·∫£. ƒê√†nh h·ªèi b√°c G√∫c v·∫≠y. sau m·ªôt h·ªìi ƒë√†o b·ªõi c≈©ng g·ªçi l√† n·∫Øm ƒë∆∞·ªçc ƒë√¥i ph·∫ßn, note ra ƒë√¢y cho b√°c n√†o c√πng chung th·∫Øc m·∫Øc.plugin l√† kh·ªâ g√¨?N√≥i th·∫ø ch·ª© plugin ch·∫Øc kh√¥ng l·∫° g√¨ r·ªìi, ƒëi·ªÉn h√¨nh nh∆∞ c√°c th·ªÉ lo·∫°i tr√¨nh duy·ªát ph·ªï bi·∫øn nh∆∞ Chrome, Firefox, Opera ki·ªÉu g√¨ m·ªói c√°i ch·∫£ c√†i m·ªôt ƒë·ªëng plugin ƒë·∫øn khi tr√¨nh duy·ªát c√≥ g√¨ b·∫•t th∆∞·ªùng l·∫°i ch·∫£ l√¥i ƒë·∫ßu m·∫•y th·∫±ng plugin ra ki·ªÉm ra ƒë·∫ßu ti√™n. m·ªôt c√°ch ƒë∆°n gi·∫£n th√¨ Plugin ch√≠nh l√† m·ªôt b·ªô ph·∫ßn m·ªÅm c√†i ƒë·∫∑t ƒë·ªÉ h·ªó tr·ª£, m·ªü r·ªông ch·ª©c nƒÉng cho m·ªôt ph·∫ßn m·ªÅm ·ª©ng d·ª•ng l·ªõn h∆°n, d·ª±a tr·∫≠n nh∆∞ng giao th·ª©c v√† API do ph·∫ßn m·ªÅm l·ªõn cung c·∫•p.plugin c√≥ g√¨ hay ho?Ki·∫øn tr√∫c plugin th·ª±c s·ª± r·∫•t tuy·ªát v·ªùi, n√≥ cho ph√©p m·ªü r·ªông (th·∫≠p ch√≠ l√† thay ƒë·ªïi) c√°c ch·ª©c nƒÉng c·ªßa c√°c host applications (t·∫°m g·ªçi l√† ·ª©ng d·ª•ng ch·ªß ƒëi), v·ªõi m·ªôt thi·∫øt k·∫ø t·ªët c√°c ·ª©ng d·ª•ng c√≥ th·ªÉ c·∫Øm th√™m bao nhi√™u ch·ª©c nƒÉng t√πy th√≠ch m·ªói plugin mang ƒë·∫øn m·ªôt ti·ªán √≠ch d·∫´n ƒë·∫øn kh·∫£ nƒÉng m·ªü r·ªông c·ªßa h·ªá th·ªëng l√† c·ª±c k·ª≥ tuy·ªát v·ªùi m√¨nh xin ph√©p ƒë∆∞·ªçc nhai l·∫°i m·ªôt l·∫ßn n·ªØa l√† ph·∫£i thi·∫øt k·∫ø cho t·ªët nh√© kh√¥ng l√† ·ª©ng √∫ng l·ªói t√πm lum ƒë√≥.V·ªõi c·ªông ƒë·ªìng m√£ ngu·ªìn m·ªü ph√°t tri·ªÉn nh∆∞ v≈© b√£o ng√†y nay, v·ªõi m·ªôt ·ª©ng d·ª•ng c√≥ base t·ªët v√† m·ªôt plugin API t·ªëi th√¨ t·ªëc ƒë·ªô ph√°t tri·ªÉn s·∫Ω kh√¥ng th·ªÉ tin n·ªïi. VD nh∆∞ slack m·ªôt h·ªá th·ªëng nh·∫Øn tin v√† trao ƒë·ªïi c√¥ng vi·ªác ƒëang r·∫•t n·ªïi tuy c≈©ng ch·ªâ m·ªõi ph√°t tri·ªÉn ƒë∆∞·ª£c v√†i nƒÉm nh∆∞ng s·ªë l∆∞·ª£ng plugin trong kho c·ªßa slack ƒë√£ r·∫•t kh·ªïng l·ªì h·∫ßu h·∫øt l√† do c√°c b√™n th·ª© ba ph·∫£t tri·ªÉn, th·ª±c s·ª± n√¢ng gi√° tr·ªã c·ªßa ·ª©ng d·ª•ng ban ƒë·∫ßu l√™n g·∫•p nhi·ªÅu l·∫ßn m√† m·ªôt team kh√¥ng th·ªÉ l√†m h·∫øt ƒë∆∞·ª£c.r·ªìi, th·∫ø c√†i ƒë·∫∑t th·∫±ng n√†y th·∫ø n√†o?ƒê·ªëi v·ªõi c√°c script language nh∆∞ Javascript, PHP, python‚Ä¶ v·ªõi d·∫∑c ƒëi·ªÉm m·ªói l·∫ßn ch·∫°y l√† m·ªôt l·∫ßn th√¥ng d·ªãch th√¨ c√≥ v·∫ª kh√¥ng g·∫∑p tr·ªü ng·∫°i g√¨ ch·ªâ vi·ªác d√πng m·ªôt th·∫±ng callback hay closure l√† xong c√°i n√†y m√¨nh s·∫Ω n√≥i ƒë·∫øn v√†o m·ªôt ng√†y ƒë·∫πp tr·ªùi kh√¥ng xa. v·ªõi java c√¢u chuy·ªán c√≥ v·∫ª kh√¥ng d·ªÖ d√†ng nh∆∞ th·∫ø, java 8 m·ªõi ra m·∫Øt t√≠nh nƒÉng Thinking cho ph√©p c√†i ƒë·∫∑t callback &amp; closure m·ªôt c√°ch kh√° d·ªÖ d√†ng c√≤n c√°c ver th·∫•p h∆°n th√¨ kh√¥ng c√≥ c√°i g√¨ t∆∞∆°ng t·ª± c·∫£, m√¨nh th√¨ g√† java n√™n c≈©ng th·∫•y v·ª• n√†y h∆°i khoai.V·ªÅ c∆° b·∫£n ƒë·ªÉ c√≥ th·ªÉ c·∫Øm ƒë∆∞·ª£c plugin th√¨ ·ª©ng d·ª•ng ph·∫£i c√≥ ki·∫øn tr√∫c ƒë∆°n gi·∫£n nh·∫•t nh∆∞ trong h√¨nh tr√™n, hai th√†nh ph·∫ßn c∆° b·∫£n ƒë√≥ l√† application core v√† plugin manager:- application core: th·∫±ng n√†y l√† ·ª©ng d·ª•ng ch·ªß c√≥ nhi·ªám b·ª• b√†o ƒë·∫£m logic c·ªßa h·ªá th·ªëng, th·ª±c hi·ªán c√°c t√°c v·ª• v√† hook (g·ªçi) c√°c plugin th·ª±c hi·ªán nhi·ªám v·ª• c·ªßa m√¨nh trong runtime.- plugins manager: th·∫±ng ch·ªãu s·ª± ch·ªâ ƒë·∫°o c·ªßa th·∫±ng core c√≥ nhi·ªám v·ª• ƒëƒÉng k√Ω c√°c plugin th√™m, g·ª°, b·∫≠t, t·∫Øt c√°c plugin.ƒê·ªÉ c√≥ th·ªÉ c·∫Øm ƒë∆∞·ª£c plugin ta ph·∫£i c√≥ m·ªôt plugin interface ƒë√¢y l√† giao di·ªán m√† t·∫•t c·∫£ c√°c plugin s·∫Ω k·∫ø th·ª´a, plugin manager s·∫ª load c√°c plugins v√† initial (n√¥m na l√† t·∫°o ra th·ª±c th·ªÉ c·ªßa m·ªói plugin) v√†o trong m·ªôt List c√°c plugins r·ªìi t·ª´ ƒë√≥ application core s·∫Ω l·∫ßn l∆∞·ªçt m√≥c ra t·ª´ c√°i m·ªôt v√† b·∫Øt n√≥ th·ª±c hi·ªán nhi·ªám v·ª• nh·∫•t ƒë·ªãnh.H√¨, m√¨nh gi·∫£i th√≠ch c·ªß chu·ªëi qu√° ch·∫Øc ko ai hi·ªÉu n·ªïi nh·ªâ. ƒë·ªÉ tr·ª±c quan sinh ƒë·ªông m·ªùi ae xem v√≠ d·ª• b√™n d∆∞·ªõi.v√≠ d·ª• tr·ª±c quan n√®·ªû v√≠ d·ª• n√†y m√¨nh s·∫Ω t·∫°o m·ªôt ·ª©ng d·ª•ng ƒë∆°n gi·∫©n v·ªõi ƒë·∫ßu v√†o l√† 1 s·ªë, c√°c plugin s·∫Ω ƒë∆∞·ªçc th√™m v√†o ƒë√™ ch·∫ø bi·∫øn s·ªë ƒë√≥ ƒë·ªÉ ƒë∆∞a ra k·∫øt qu·∫£ cu·ªëi c√πng c·ªông tr·ª´ nh√¢n chia g√¨ ƒë√≥.Ok, ƒë·∫ßu ti√™n ch√∫ng ta ph·∫£i c√≥ m·ªôt th·∫±ng interface chung cho c√°c plugins. t·∫°m g·ªçi l√† PluginFunction.java ƒëi.123456789101112131415public interface PluginFunction &#123;\t// let the application pass in a parameter\tpublic void setParameter (int param);\t// retrieve a result from the plugin\tpublic int getResult();\t// return the name of this plugin\tpublic String getPluginName();\t// can be called to determine whether the plugin\t// aborted execution due to an error condition\tpublic boolean hasError();&#125;Ti·∫øp theo ta ph·∫£i c√≥ m·ªôt c√°i main ƒë·ªÉ ch·∫°y logic c·ªßa ·ª©ng d·ª•ng v√† g·ªçi c√°c plugin, ta g·ªçi l√† PluginDemo.java ch·ª©a h√†m main.1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889import java.io.File;import java.util.*;public class PluginDemo &#123;\t//parameter for plugins\tint count;\t// the directory where we keep the plugin classes\tString pluginsDir;\t// a list where we keep an initialized object of each plugin class\tList plugins;\tpublic static void main (String args[]) &#123;\t\tPluginDemo demo = new PluginDemo(args);\t\tdemo.getPlugins();\t\tdemo.runPlugins();\t&#125;\tPluginDemo (String args[]) &#123;\t\tif (args.length &gt; 0)\t\t\tcount = Integer.parseInt(args[0]);\t\telse\t\t\tcount = 1;\t\tif (args.length &gt; 1)\t\t\tpluginsDir = args[0];\t\telse\t\t\tpluginsDir = \"plugins\";\t\tplugins = new ArrayList();\t\tSystem.setSecurityManaghttps://analytics.google.com/analytics/web/?authuser=0#croverview/cr-overview/a79213161w118319613p123773431/er(new PluginSecurityManager(pluginsDir));\t&#125;\tprotected void getPlugins() &#123;\t\tFile dir = new File(System.getProperty(\"user.dir\") + File.separator + pluginsDir);\t\tClassLoader cl = new PluginClassLoader(dir);\t\tif (dir.exists() &amp;&amp; dir.isDirectory()) &#123;\t\t\t// we'll only load classes directly in this directory -\t\t\t// no subdirectories, and no classes in packages are recognized\t\t\tString[] files = dir.list();\t\t\tfor (int i=0; i&lt;files.length; i++) &#123;\t\t\t\ttry &#123;\t\t\t\t\t// only consider files ending in \".class\"\t\t\t\t\tif (! files[i].endsWith(\".class\"))\t\t\t\t\t\tcontinue;\t\t\t\t\tClass c = cl.loadClass(files[i].substring(0, files[i].indexOf(\".\")));\t\t\t\t\tClass[] intf = c.getInterfaces();\t\t\t\t\tfor (int j=0; j&lt;intf.length; j++) &#123;\t\t\t\t\t\tif (intf[j].getName().equals(\"PluginFunction\")) &#123;\t\t\t\t\t\t\t// the following line assumes that PluginFunction has a no-argument constructor\t\t\t\t\t\t\tPluginFunction pf = (PluginFunction) c.newInstance();\t\t\t\t\t\t\tplugins.add(pf);\t\t\t\t\t\t\tcontinue;\t\t\t\t\t\t&#125;\t\t\t\t\t&#125;\t\t\t\t&#125; catch (Exception ex) &#123;\t\t\t\t\tSystem.err.println(\"File \" + files[i] + \" does not contain a valid PluginFunction class.\");\t\t\t\t&#125;\t\t\t&#125;\t\t&#125;\t&#125;\tprotected void runPlugins() &#123;\t\tIterator iter = plugins.iterator();\t\twhile (iter.hasNext()) &#123;\t\t\tPluginFunction pf = (PluginFunction) iter.next();\t\t\ttry &#123;\t\t\t\tpf.setParameter(count);\t\t\t\tSystem.out.print(pf.getPluginName());\t\t\t\tSystem.out.print(\" ( \"+count+\" ) = \");\t\t\t\tif (pf.hasError()) &#123;\t\t\t\t\tSystem.out.println(\"there was an error during plugin initialization\");\t\t\t\t\tcontinue;\t\t\t\t&#125;\t\t\t\tint result = pf.getResult();\t\t\t\tif (pf.hasError())\t\t\t\t\tSystem.out.println(\"there was an error during plugin execution\");\t\t\t\telse\t\t\t\t\tSystem.out.println(result);\t\t\t\tcount++;\t\t\t&#125; catch (SecurityException secEx) &#123;\t\t\t\tSystem.err.println(\"plugin '\"+pf.getClass().getName()+\"' tried to do something illegal\");\t\t\t&#125;\t\t&#125;\t&#125;&#125;Ta th·∫•y trong h√†m getPlugins c√≥ m·ªôt v√≤ng for ƒë·ªÉ load h·∫øt c√°c class m√† c√≥ interface l√† PluginFunction r·ªìi t·∫°o ra m·ªôt th·ª±c th·ªÉ c·ªßa class ƒë√≥ v√† l∆∞u v√†o m·∫£ng plugins. Sau ƒë√≥ h√†m runPlugins s·∫Ω duy·ªát qua t·∫•t c·∫£ c·∫£c plugins set tham s·ªë ch·∫°y h√†m run c·ªßa t·ª´ng plugin v√† in ra k·∫øt qu·∫£.Ngo√†i ra h√†m getPlugins c√≤n c√≥ m·ªôt ƒëi·ªÅu th√∫ v·ªã n·ªØa ch√≠nh l√† d√≤ng setSecurityManager, v√¨ ƒë√¢y l√† c√°c plugins ƒë·ªôc l·∫≠p v·ªõi h·ªá th·ªëng n√™n ta phhair x√©t qu·ªÅn h·∫°n cho n√≥ ch·ª© nh·ª° thanh ni√™n n√†o vui t√≠nh l·∫°i cho c√°i plugin x√≥a h·∫øt h·ªá ƒëi·ªÅu h√†nh th√¨ ch·ªâ bi·∫øt ng·ªìi ƒë·∫•y m√† kh√≥c th√¥i üò≠.ƒê√¢y l√† n·ªôi dung file PluginSecurityManager.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106import java.io.File;/*** This is a fairly uptight security manager subclass. Classes loaded by* the PluginClassLoader are highly restricted in what they are allowed to do.* This is okay, because they're only supposed to calculate some values,* for which all necessary data is already available to them.** A SecurityManager consists of various methods that the system calls to* check whether certain sensitive operations should be allowed. These* methods can throw a SecurityException to prevent the operation from* happening. With this SecurityManager, we want to prevent untrusted* code that was loaded by a class loader from performing those sensitive operations.* So we use inherited SecurityManager methods to check whether the call is being* made by an untrusted class. If it is, we throw an exception.* Otherwise, we simply return, allowing the operation to proceed normally.*/public class PluginSecurityManager extends SecurityManager &#123;\tprivate String pluginDir = null;\tPluginSecurityManager (String dir) &#123;\t\tpluginDir = dir;\t&#125;\t/**\t * This is the basic method that tests whether there is a class loaded\t * by a ClassLoader anywhere on the stack. If so, it means that that\t * untrusted code is trying to perform some kind of sensitive operation.\t * We prevent it from performing that operation by throwing an exception.\t * trusted() is called by most of the check...() methods below.\t */\tprotected void trusted() &#123;\t\tif (inClassLoader()) throw new SecurityException();\t&#125;\t/**\t * These are all the specific checks that a security manager can\t * perform. They all just call one of the methods above and throw a\t * SecurityException if the operation is not allowed. This \t * SecurityManager subclass is perhaps a little too restrictive. For\t * example, it doesn't allow loaded code to read *any* system properties,\t * even though some of them are quite harmless.\t */\tpublic void checkCreateClassLoader() &#123; trusted(); &#125;\tpublic void checkAccess (Thread g) &#123; trusted(); &#125;\tpublic void checkAccess (ThreadGroup g) &#123; trusted(); &#125;\tpublic void checkExit (int status) &#123; throw new SecurityException(\"Not allowed.\"); &#125;\tpublic void checkExec (String cmd) &#123; trusted(); &#125;\tpublic void checkLink (String lib) &#123; trusted(); &#125;\tpublic void checkRead (java.io.FileDescriptor fd) &#123; trusted(); &#125;\tpublic void checkRead (String file) &#123;//\t\tString path = new File(file).getParentFile().getAbsolutePath();//\t\tif (! path.endsWith(pluginDir))\t\t\ttrusted();\t&#125;\tpublic void checkRead (String file, Object context) &#123; trusted(); &#125;\tpublic void checkWrite (java.io.FileDescriptor fd) &#123; trusted(); &#125;\tpublic void checkWrite (String file) &#123; trusted(); &#125;\tpublic void checkDelete (String file) &#123; trusted(); &#125;\tpublic void checkConnect (String host, int port) &#123; trusted(); &#125;\tpublic void checkConnect (String host,int port,Object context) &#123;trusted();&#125;\tpublic void checkListen (int port) &#123; trusted(); &#125;\tpublic void checkAccept (String host, int port) &#123; trusted(); &#125;\tpublic void checkMulticast (java.net.InetAddress maddr) &#123; trusted(); &#125;\tpublic void checkMulticast (java.net.InetAddress maddr, byte ttl) &#123; trusted(); &#125;\tpublic void checkPropertiesAccess() &#123; trusted(); &#125;\tpublic void checkPropertyAccess (String key) &#123;//\t\tif (! key.equals(\"user.dir\"))\t\t\ttrusted();\t&#125;\tpublic void checkPrintJobAccess() &#123; trusted(); &#125;\tpublic void checkSystemClipboardAccess() &#123; trusted(); &#125;\tpublic void checkAwtEventQueueAccess() &#123; trusted(); &#125;\tpublic void checkSetFactory() &#123; trusted(); &#125;\tpublic void checkMemberAccess (Class clazz, int which) &#123; trusted(); &#125;\tpublic void checkSecurityAccess (String provider) &#123; trusted(); &#125;\t/** Loaded code can only load classes from java.* packages */\tpublic void checkPackageAccess (String pkg) &#123; \t\tif (inClassLoader() &amp;&amp; !pkg.startsWith(\"java.\") &amp;&amp; !pkg.startsWith(\"javax.\"))\t\t\tthrow new SecurityException();\t&#125;\t/** Loaded code can't define classes in java.* or sun.* packages */\tpublic void checkPackageDefinition (String pkg) &#123; \t\tif (inClassLoader() &amp;&amp; ((pkg.startsWith(\"java.\") || pkg.startsWith(\"javax.\") || pkg.startsWith(\"sun.\"))))\t\t\tthrow new SecurityException();\t&#125;\t/** \t * This is the one SecurityManager method that is different from the\t * others. It indicates whether a top-level window should display an\t * \"untrusted\" warning. The window is always allowed to be created, so\t * this method is not normally meant to throw an exception. It should\t * return true if the window does not need to display the warning, and\t * false if it does. In this example, however, our text-based Service\t * classes should never need to create windows, so we will actually\t * throw an exception to prevent any windows from being opened.\t **/\tpublic boolean checkTopLevelWindow (Object window) &#123; \t\ttrusted();\t\treturn true; \t&#125;&#125;Ngo√†i ra ta c√≤n c·∫ßn 1 c√°i loader ƒë·ªÉ load c√°c plugins ra n·ªØa PluginClassLoader.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687import java.io.*;  /**   * In order to impose tight security restrictions on untrusted classes but   * not on trusted system classes, we have to be able to distinguish between   * those types of classes. This is done by keeping track of how the classes   * are loaded into the system. By definition, any class that the interpreter   * loads directly from the CLASSPATH is trusted. This means that we can't   * load untrusted code in that way--we can't load it with Class.forName().   * Instead, we create a ClassLoader subclass to load the untrusted code.   * This one loads classes from a specified directory (which should not   * be part of the CLASSPATH).   */public class PluginClassLoader extends ClassLoader &#123;    /** This is the directory from which the classes will be loaded */    File directory;    /** The constructor. Just initialize the directory */    public PluginClassLoader (File dir) &#123;\t\tdirectory = dir;\t&#125;    /** A convenience method that calls the 2-argument form of this method */    public Class loadClass (String name) throws ClassNotFoundException &#123;       return loadClass(name, true);     &#125;    /**     * This is one abstract method of ClassLoader that all subclasses must     * define. Its job is to load an array of bytes from somewhere and to     * pass them to defineClass(). If the resolve argument is true, it must     * also call resolveClass(), which will do things like verify the presence     * of the superclass. Because of this second step, this method may be called to     * load superclasses that are system classes, and it must take this into account.     */    public Class loadClass (String classname, boolean resolve) throws ClassNotFoundException &#123;      try &#123;        // Our ClassLoader superclass has a built-in cache of classes it has        // already loaded. So, first check the cache.        Class c = findLoadedClass(classname);        // After this method loads a class, it will be called again to        // load the superclasses. Since these may be system classes, we've        // got to be able to load those too. So try to load the class as        // a system class (i.e. from the CLASSPATH) and ignore any errors        if (c == null) &#123;          try &#123; c = findSystemClass(classname); &#125;          catch (Exception ex) &#123;&#125;        &#125;        // If the class wasn't found by either of the above attempts, then        // try to load it from a file in (or beneath) the directory        // specified when this ClassLoader object was created. Form the        // filename by replacing all dots in the class name with        // (platform-independent) file separators and by adding the \".class\" extension.        if (c == null) &#123;          // Figure out the filename          String filename = classname.replace('.',File.separatorChar)+\".class\";          // Create a File object. Interpret the filename relative to the          // directory specified for this ClassLoader.          File f = new File(directory, filename);          // Get the length of the class file, allocate an array of bytes for          // it, and read it in all at once.          int length = (int) f.length();          byte[] classbytes = new byte[length];          DataInputStream in = new DataInputStream(new FileInputStream(f));          in.readFully(classbytes);          in.close();          // Now call an inherited method to convert those bytes into a Class          c = defineClass(classname, classbytes, 0, length);        &#125;        // If the resolve argument is true, call the inherited resolveClass method.        if (resolve) resolveClass(c);        // And we're done. Return the Class object we've loaded.        return c;      &#125;      // If anything goes wrong, throw a ClassNotFoundException error      catch (Exception ex) &#123; throw new ClassNotFoundException(ex.toString()); &#125;    &#125;&#125;Haiz, v·ªÅ c∆° b·∫£n h·ªá th·ªëng setup th·∫ø l√† xong, ti·∫øp theo ta s·∫Ω c·∫ßn 1 2 c√°i plugins ƒë·ªÉ test th·ªß xem n√≥ c√≥ ch·∫°y ·ªïn kh√¥ng, ta s·∫Ω ƒë·∫∑t c√°c file n√†y trong th∆∞ m·ª•c plugins.Square.java t√¨nh b√¨nh ph∆∞ng c·ªßa tham s·ªë:12345678910111213141516171819202122232425/** * This plugin squares its argument. */public class Square implements PluginFunction &#123;\tint parameter = 0;\tpublic void setParameter (int param) &#123;\t\tparameter = param;\t&#125;\tpublic int getResult() &#123;\t\treturn parameter * parameter;\t&#125;\tpublic String getPluginName() &#123;\t\treturn \"Square\";\t&#125;\t// yes, this operation can fail, but we are going to ignore this here\tpublic boolean hasError() &#123;\t\treturn false;\t&#125;&#125;PlusOne.java c·ªông 1 ƒë∆°n v·ªã v√†o tham s·ªë:12345678910111213141516171819202122232425/** * This plugin adds one to the parameter. */public class PlusOne implements PluginFunction &#123;\tint parameter = 0;\tpublic void setParameter (int param) &#123;\t\tparameter = param;\t&#125;\tpublic int getResult() &#123;\t\treturn parameter + 1;\t&#125;\tpublic String getPluginName() &#123;\t\treturn \"PlusOne\";\t&#125;\t// yes, ths operation can fail, but we are going to ignore this here\tpublic boolean hasError() &#123;\t\treturn false;\t&#125;&#125;TryToExit.java th·ª≠ cho thanh ni√™n n√†y l·∫°m qu·ªÅn t√Ω xem c√≥ ƒë∆∞·ªçc kh√¥ng, trong PluginSecurityManager ta ƒë√£ set kh√¥ng cho plugin tho√°t ch∆∞∆°ng tr√¨nh r·ªìi.1234567891011121314151617181920212223242526/** * This plugin tries to call System.exit(), which the SecurityManager doesn't allow. */public class TryToExit implements PluginFunction &#123;\tpublic void setParameter (int param) &#123;\t\t// this function doesn't care about its parameter,\t\t// so it doesn't even store it for later use\t&#125;\tpublic int getResult() &#123;\t\t// The next line will be caught by the SecurityManagers 'checkExit' method.\t\tSystem.exit(0);\t\treturn 42;\t&#125;\tpublic String getPluginName() &#123;\t\treturn \"TryToExit\";\t&#125;\t// yes, this operation can fail, but we are going to ignore this here\tpublic boolean hasError() &#123;\t\treturn false;\t&#125;&#125;Ti·∫øp theo l√† d·ªãch v√† ch·∫°y th·ª≠, n·∫øu kh√¥ng c√≥ g√¨ sai th√¨ s·∫Ω thu ƒë∆∞·ª£c output nh∆∞ n√†y, m√¨nh d√πng java 8 n√™n c√≥ phun ra m·∫•y c√°i Note, th√¥i k·ªá d√π sao n√≥ v·∫´n ch·∫°y ƒë∆∞·ª£c üòÑ:123456789minh@MINH-PC:~/Desktop/Plugin$ javac *.javaNote: PluginSecurityManager.java uses or overrides a deprecated API.Note: Recompile with -Xlint:deprecation for details.Note: PluginDemo.java uses unchecked or unsafe operations.Note: Recompile with -Xlint:unchecked for details.minh@MINH-PC:~/Desktop/Plugin$ java PluginDemoTryToExit ( 1 ) = plugin 'TryToExit' tried to do something illegalPlusOne ( 1 ) = 2Square ( 2 ) = 4Th·ª±c ra toppic n√†y c√≤n th√™m v·∫•n ƒë·ªÅ n·ªØa l√† build ra file jar v√† c√†i ƒë·∫∑t plugin b·∫±ng xml nh∆∞ng t·∫°p th·ªùi th·∫ø n√†y ƒë√£. xin h·∫πn ae m·ªôt d·ªãp kh√°c.Xin ch√¢n th√†nh c·∫£m ∆°n b·ªô code m·∫´u c·ªßa @Ulf Dittmer, c√°c b·∫°n code th·ªÉ download code d·ªÉ tham kh·∫£o.Ph√πu‚Ä¶ c·∫£m ∆°n ae ƒë√£ theo d√µi ƒë·∫øn t·∫≠n ƒë√¢y, b√†i ƒë√£ d√†i tay quay ƒë√£ m·ªèi m√¨nh xin ph√©p d·ª´ng ph√≠m t·∫°i ƒë√¢y. ch√∫c ae cu·ªëi tu·∫ßn vui v·∫ª.xin ch√†o th√¢n √°i v√† qu·∫øt th·∫Øng.","dateCreated":"2016-08-06T19:08:51+07:00","dateModified":"2019-10-13T22:56:12+07:00","datePublished":"2016-08-06T19:08:51+07:00","description":"Ch·∫£ l√† ƒëang t·∫≠p t·ªçe l√†m wordpress plugin, b·ªóng d∆∞ng n·∫£y ra c√¢u h·ªèi th·∫ø c√†i ƒë·∫∑t plugin trong java nh∆∞ th·∫ø n√†o. Tr∆∞·ªõc gi·ªù c≈©ng ch·ªâ l√†m theo ki·ªÉu y√™u c·∫ßu ƒë·∫øn ƒë√¢u vi·∫øt ƒë·∫øn ƒë·∫•y ch·ª© ch∆∞a ƒë∆∞·ª£c l√†m ki·ªÉu plugin n√†y bao gi·ªù c·∫£. ƒê√†nh h·ªèi b√°c G√∫c v·∫≠y. sau m·ªôt h·ªìi ƒë√†o b·ªõi c≈©ng g·ªçi l√† n·∫Øm ƒë∆∞·ªçc ƒë√¥i ph·∫ßn, note ra ƒë√¢y cho b√°c n√†o c√πng chung th·∫Øc m·∫Øc.","headline":"vi·∫øt m·ªôt ch∆∞∆°ng tr√¨nh cho ph√©p c√†i plugin trong java nh∆∞ th·∫ø n√†o?","image":["plugin_icon.jpg","plugin.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/"},"publisher":{"@type":"Organization","name":"Minh Luc","sameAs":["https://github.com/minhlucvan","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/minhlucvan.3","https://plus.google.com/","https://www.linkedin.com/profile/","mailto:luk.mink@gmail.com"],"image":"https://www.buildabear.com/dw/image/v2/BBNG_PRD/on/demandware.static/-/Sites-buildabear-master/default/dwdfa7c1cf/27618_27630_25342_24630x.jpg?sw=600&sh=600&sm=fit&q=70","logo":{"@type":"ImageObject","url":"https://www.buildabear.com/dw/image/v2/BBNG_PRD/on/demandware.static/-/Sites-buildabear-master/default/dwdfa7c1cf/27618_27630_25342_24630x.jpg?sw=600&sh=600&sm=fit&q=70"}},"url":"/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/","keywords":"design pattern, java","thumbnailUrl":"plugin_icon.jpg"}</script><meta name="description" content="Ch·∫£ l√† ƒëang t·∫≠p t·ªçe l√†m wordpress plugin, b·ªóng d∆∞ng n·∫£y ra c√¢u h·ªèi th·∫ø c√†i ƒë·∫∑t plugin trong java nh∆∞ th·∫ø n√†o. Tr∆∞·ªõc gi·ªù c≈©ng ch·ªâ l√†m theo ki·ªÉu y√™u c·∫ßu ƒë·∫øn ƒë√¢u vi·∫øt ƒë·∫øn ƒë·∫•y ch·ª© ch∆∞a ƒë∆∞·ª£c l√†m ki·ªÉu plugi"><meta name="keywords" content="design pattern,java"><meta property="og:type" content="blog"><meta property="og:title" content="vi·∫øt m·ªôt ch∆∞∆°ng tr√¨nh cho ph√©p c√†i plugin trong java nh∆∞ th·∫ø n√†o?"><meta property="og:url" content="/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/index.html"><meta property="og:site_name" content="Minh Luc&#39;s Blog"><meta property="og:description" content="Ch·∫£ l√† ƒëang t·∫≠p t·ªçe l√†m wordpress plugin, b·ªóng d∆∞ng n·∫£y ra c√¢u h·ªèi th·∫ø c√†i ƒë·∫∑t plugin trong java nh∆∞ th·∫ø n√†o. Tr∆∞·ªõc gi·ªù c≈©ng ch·ªâ l√†m theo ki·ªÉu y√™u c·∫ßu ƒë·∫øn ƒë√¢u vi·∫øt ƒë·∫øn ƒë·∫•y ch·ª© ch∆∞a ƒë∆∞·ª£c l√†m ki·ªÉu plugi"><meta property="og:locale" content="vi"><meta property="og:image" content="/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/application-architecture.png"><meta property="og:updated_time" content="2019-10-13T15:56:12.638Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="vi·∫øt m·ªôt ch∆∞∆°ng tr√¨nh cho ph√©p c√†i plugin trong java nh∆∞ th·∫ø n√†o?"><meta name="twitter:description" content="Ch·∫£ l√† ƒëang t·∫≠p t·ªçe l√†m wordpress plugin, b·ªóng d∆∞ng n·∫£y ra c√¢u h·ªèi th·∫ø c√†i ƒë·∫∑t plugin trong java nh∆∞ th·∫ø n√†o. Tr∆∞·ªõc gi·ªù c≈©ng ch·ªâ l√†m theo ki·ªÉu y√™u c·∫ßu ƒë·∫øn ƒë√¢u vi·∫øt ƒë·∫øn ƒë·∫•y ch·ª© ch∆∞a ƒë∆∞·ª£c l√†m ki·ªÉu plugi"><meta name="twitter:image" content="/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/application-architecture.png"><meta name="twitter:creator" content="@minhlucvan"><meta property="og:image" content="https://www.buildabear.com/dw/image/v2/BBNG_PRD/on/demandware.static/-/Sites-buildabear-master/default/dwdfa7c1cf/27618_27630_25342_24630x.jpg?sw=600&amp;sh=600&amp;sm=fit&amp;q=70"><meta property="og:image" content="/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/plugin_icon.jpg"><meta class="swiftype" name="image" data-type="enum" content="/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/plugin_icon.jpg"><meta property="og:image" content="/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/plugin.png"><meta class="swiftype" name="image" data-type="enum" content="/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/plugin.png"><link rel="stylesheet" href="/assets/css/style-vauplnmuudawtrvs9qoe2qiqczrszudvtrtqf2khoqbe0hmw3ovkgnoc5u4n.min.css"></head><body><div id="blog"><header id="header" data-behavior="4"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">Minh Luc&#39;s Blog</a></div><a class="header-right-picture" href="#about" aria-label="Open the link: /#about"><img class="header-picture" src="https://www.buildabear.com/dw/image/v2/BBNG_PRD/on/demandware.static/-/Sites-buildabear-master/default/dwdfa7c1cf/27618_27630_25342_24630x.jpg?sw=600&amp;sh=600&amp;sm=fit&amp;q=70" alt="Author&#39;s picture"></a></header><nav id="sidebar" data-behavior="4"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="Read more about the author"><img class="sidebar-profile-picture" src="https://www.buildabear.com/dw/image/v2/BBNG_PRD/on/demandware.static/-/Sites-buildabear-master/default/dwdfa7c1cf/27618_27630_25342_24630x.jpg?sw=600&amp;sh=600&amp;sm=fit&amp;q=70" alt="Author&#39;s picture"></a><h4 class="sidebar-profile-name">Minh Luc</h4><h5 class="sidebar-profile-bio"><p>author.bio</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" title="Home"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">Home</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/categories" title="Categories"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">Categories</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/tags" title="Tags"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">Tags</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/archives" title="Archives"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">Archives</span></a></li><li class="sidebar-button"><a class="sidebar-button-link open-algolia-search" href="#search" title="Search"><i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i> <span class="sidebar-button-desc">Search</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/about" title="About"><i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i> <span class="sidebar-button-desc">About</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/minhlucvan" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="http://stackoverflow.com/users" title="Stack Overflow"><i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i> <span class="sidebar-button-desc">Stack Overflow</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="https://twitter.com/" title="Twitter"><i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i> <span class="sidebar-button-desc">Twitter</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="https://facebook.com/minhlucvan.3" title="Facebook"><i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i> <span class="sidebar-button-desc">Facebook</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="https://plus.google.com/" title="Google +"><i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i> <span class="sidebar-button-desc">Google +</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="https://www.linkedin.com/profile/" title="LinkedIn"><i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i> <span class="sidebar-button-desc">LinkedIn</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto:luk.mink@gmail.com" title="Mail"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">Mail</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/atom.xml" title="RSS"><i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i> <span class="sidebar-button-desc">RSS</span></a></li></ul></div></nav><div class="post-header-cover text-left" style="background-image:url(/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/plugin.png)" data-behavior="4"></div><div id="main" data-behavior="4" class="hasCover hasCoverMetaOut"><article class="post"><div class="post-header main-content-wrap text-left"><h1 class="post-title">vi·∫øt m·ªôt ch∆∞∆°ng tr√¨nh cho ph√©p c√†i plugin trong java nh∆∞ th·∫ø n√†o?</h1><div class="post-meta"><time datetime="2016-08-06T19:08:51+07:00">Th08 06, 2016 </time><span>in </span><a class="category-link" href="/categories/lap-trinh/">l·∫≠p tr√¨nh</a></div></div><div class="post-content markdown"><div class="main-content-wrap"><p>Ch·∫£ l√† ƒëang t·∫≠p t·ªçe l√†m wordpress plugin, b·ªóng d∆∞ng n·∫£y ra c√¢u h·ªèi th·∫ø c√†i ƒë·∫∑t plugin trong java nh∆∞ th·∫ø n√†o. Tr∆∞·ªõc gi·ªù c≈©ng ch·ªâ l√†m theo ki·ªÉu y√™u c·∫ßu ƒë·∫øn ƒë√¢u vi·∫øt ƒë·∫øn ƒë·∫•y ch·ª© ch∆∞a ƒë∆∞·ª£c l√†m ki·ªÉu plugin n√†y bao gi·ªù c·∫£. ƒê√†nh h·ªèi b√°c G√∫c v·∫≠y. sau m·ªôt h·ªìi ƒë√†o b·ªõi c≈©ng g·ªçi l√† n·∫Øm ƒë∆∞·ªçc ƒë√¥i ph·∫ßn, note ra ƒë√¢y cho b√°c n√†o c√πng chung th·∫Øc m·∫Øc.</p><a id="more"></a><h1>plugin l√† kh·ªâ g√¨?</h1><p>N√≥i th·∫ø ch·ª© plugin ch·∫Øc kh√¥ng l·∫° g√¨ r·ªìi, ƒëi·ªÉn h√¨nh nh∆∞ c√°c th·ªÉ lo·∫°i tr√¨nh duy·ªát ph·ªï bi·∫øn nh∆∞ Chrome, Firefox, Opera ki·ªÉu g√¨ m·ªói c√°i ch·∫£ c√†i m·ªôt ƒë·ªëng plugin ƒë·∫øn khi tr√¨nh duy·ªát c√≥ g√¨ b·∫•t th∆∞·ªùng l·∫°i ch·∫£ l√¥i ƒë·∫ßu m·∫•y th·∫±ng plugin ra ki·ªÉm ra ƒë·∫ßu ti√™n. m·ªôt c√°ch ƒë∆°n gi·∫£n th√¨ Plugin ch√≠nh l√† m·ªôt b·ªô ph·∫ßn m·ªÅm c√†i ƒë·∫∑t ƒë·ªÉ h·ªó tr·ª£, m·ªü r·ªông ch·ª©c nƒÉng cho m·ªôt ph·∫ßn m·ªÅm ·ª©ng d·ª•ng l·ªõn h∆°n, d·ª±a tr·∫≠n nh∆∞ng giao th·ª©c v√† API do ph·∫ßn m·ªÅm l·ªõn cung c·∫•p.</p><h1>plugin c√≥ g√¨ hay ho?</h1><p>Ki·∫øn tr√∫c plugin th·ª±c s·ª± r·∫•t tuy·ªát v·ªùi, n√≥ cho ph√©p m·ªü r·ªông (th·∫≠p ch√≠ l√† thay ƒë·ªïi) c√°c ch·ª©c nƒÉng c·ªßa c√°c host applications (t·∫°m g·ªçi l√† ·ª©ng d·ª•ng ch·ªß ƒëi), v·ªõi m·ªôt thi·∫øt k·∫ø t·ªët c√°c ·ª©ng d·ª•ng c√≥ th·ªÉ c·∫Øm th√™m bao nhi√™u ch·ª©c nƒÉng t√πy th√≠ch m·ªói plugin mang ƒë·∫øn m·ªôt ti·ªán √≠ch d·∫´n ƒë·∫øn kh·∫£ nƒÉng m·ªü r·ªông c·ªßa h·ªá th·ªëng l√† c·ª±c k·ª≥ tuy·ªát v·ªùi m√¨nh xin ph√©p ƒë∆∞·ªçc nhai l·∫°i m·ªôt l·∫ßn n·ªØa l√† ph·∫£i thi·∫øt k·∫ø cho t·ªët nh√© kh√¥ng l√† ·ª©ng √∫ng l·ªói t√πm lum ƒë√≥.</p><p>V·ªõi c·ªông ƒë·ªìng m√£ ngu·ªìn m·ªü ph√°t tri·ªÉn nh∆∞ v≈© b√£o ng√†y nay, v·ªõi m·ªôt ·ª©ng d·ª•ng c√≥ base t·ªët v√† m·ªôt plugin API t·ªëi th√¨ t·ªëc ƒë·ªô ph√°t tri·ªÉn s·∫Ω kh√¥ng th·ªÉ tin n·ªïi. VD nh∆∞ <a href="https://www.youtube.com/watch?v=B6zVzWU95Sw" target="_blank" rel="noopener">slack</a> m·ªôt h·ªá th·ªëng nh·∫Øn tin v√† trao ƒë·ªïi c√¥ng vi·ªác ƒëang r·∫•t n·ªïi tuy c≈©ng ch·ªâ m·ªõi ph√°t tri·ªÉn ƒë∆∞·ª£c v√†i nƒÉm nh∆∞ng s·ªë l∆∞·ª£ng plugin trong kho c·ªßa slack ƒë√£ r·∫•t kh·ªïng l·ªì h·∫ßu h·∫øt l√† do c√°c b√™n th·ª© ba ph·∫£t tri·ªÉn, th·ª±c s·ª± n√¢ng gi√° tr·ªã c·ªßa ·ª©ng d·ª•ng ban ƒë·∫ßu l√™n g·∫•p nhi·ªÅu l·∫ßn m√† m·ªôt team kh√¥ng th·ªÉ l√†m h·∫øt ƒë∆∞·ª£c.</p><h1>r·ªìi, th·∫ø c√†i ƒë·∫∑t th·∫±ng n√†y th·∫ø n√†o?</h1><p>ƒê·ªëi v·ªõi c√°c script language nh∆∞ Javascript, PHP, python‚Ä¶ v·ªõi d·∫∑c ƒëi·ªÉm m·ªói l·∫ßn ch·∫°y l√† m·ªôt l·∫ßn <strong>th√¥ng</strong> d·ªãch th√¨ c√≥ v·∫ª kh√¥ng g·∫∑p tr·ªü ng·∫°i g√¨ ch·ªâ vi·ªác d√πng m·ªôt th·∫±ng callback hay closure l√† xong c√°i n√†y m√¨nh s·∫Ω n√≥i ƒë·∫øn v√†o m·ªôt ng√†y ƒë·∫πp tr·ªùi kh√¥ng xa. v·ªõi java c√¢u chuy·ªán c√≥ v·∫ª kh√¥ng d·ªÖ d√†ng nh∆∞ th·∫ø, java 8 m·ªõi ra m·∫Øt t√≠nh nƒÉng <a href="http://www.linuxtopia.org/online_books/programming_books/thinking_in_java/TIJ310_019.htm" target="_blank" rel="noopener">Thinking</a> cho ph√©p c√†i ƒë·∫∑t callback &amp; closure m·ªôt c√°ch kh√° d·ªÖ d√†ng c√≤n c√°c ver th·∫•p h∆°n th√¨ kh√¥ng c√≥ c√°i g√¨ t∆∞∆°ng t·ª± c·∫£, m√¨nh th√¨ g√† java n√™n c≈©ng th·∫•y v·ª• n√†y h∆°i khoai.</p><p><img src="application-architecture.png" alt="application architecture"></p><p>V·ªÅ c∆° b·∫£n ƒë·ªÉ c√≥ th·ªÉ c·∫Øm ƒë∆∞·ª£c plugin th√¨ ·ª©ng d·ª•ng ph·∫£i c√≥ ki·∫øn tr√∫c ƒë∆°n gi·∫£n nh·∫•t nh∆∞ trong h√¨nh tr√™n, hai th√†nh ph·∫ßn c∆° b·∫£n ƒë√≥ l√† application core v√† plugin manager:<br>- <strong>application core:</strong> th·∫±ng n√†y l√† ·ª©ng d·ª•ng ch·ªß c√≥ nhi·ªám b·ª• b√†o ƒë·∫£m logic c·ªßa h·ªá th·ªëng, th·ª±c hi·ªán c√°c t√°c v·ª• v√† hook (g·ªçi) c√°c plugin th·ª±c hi·ªán nhi·ªám v·ª• c·ªßa m√¨nh trong runtime.<br>- <strong>plugins manager:</strong> th·∫±ng ch·ªãu s·ª± ch·ªâ ƒë·∫°o c·ªßa th·∫±ng core c√≥ nhi·ªám v·ª• ƒëƒÉng k√Ω c√°c plugin th√™m, g·ª°, b·∫≠t, t·∫Øt c√°c plugin.</p><p>ƒê·ªÉ c√≥ th·ªÉ c·∫Øm ƒë∆∞·ª£c plugin ta ph·∫£i c√≥ m·ªôt plugin interface ƒë√¢y l√† giao di·ªán m√† t·∫•t c·∫£ c√°c plugin s·∫Ω k·∫ø th·ª´a, plugin manager s·∫ª load c√°c plugins v√† initial (n√¥m na l√† t·∫°o ra th·ª±c th·ªÉ c·ªßa m·ªói plugin) v√†o trong m·ªôt List c√°c plugins r·ªìi t·ª´ ƒë√≥ application core s·∫Ω l·∫ßn l∆∞·ªçt m√≥c ra t·ª´ c√°i m·ªôt v√† b·∫Øt n√≥ th·ª±c hi·ªán nhi·ªám v·ª• nh·∫•t ƒë·ªãnh.</p><p>H√¨, m√¨nh gi·∫£i th√≠ch c·ªß chu·ªëi qu√° ch·∫Øc ko ai hi·ªÉu n·ªïi nh·ªâ. ƒë·ªÉ tr·ª±c quan sinh ƒë·ªông m·ªùi ae xem v√≠ d·ª• b√™n d∆∞·ªõi.</p><h1>v√≠ d·ª• tr·ª±c quan n√®</h1><p>·ªû v√≠ d·ª• n√†y m√¨nh s·∫Ω t·∫°o m·ªôt ·ª©ng d·ª•ng ƒë∆°n gi·∫©n v·ªõi ƒë·∫ßu v√†o l√† 1 s·ªë, c√°c plugin s·∫Ω ƒë∆∞·ªçc th√™m v√†o ƒë√™ ch·∫ø bi·∫øn s·ªë ƒë√≥ ƒë·ªÉ ƒë∆∞a ra k·∫øt qu·∫£ cu·ªëi c√πng c·ªông tr·ª´ nh√¢n chia g√¨ ƒë√≥.</p><p>Ok, ƒë·∫ßu ti√™n ch√∫ng ta ph·∫£i c√≥ m·ªôt th·∫±ng interface chung cho c√°c plugins. t·∫°m g·ªçi l√† <code>PluginFunction.java</code> ƒëi.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PluginFunction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// let the application pass in a parameter</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span> <span class="params">(<span class="keyword">int</span> param)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// retrieve a result from the plugin</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// return the name of this plugin</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPluginName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// can be called to determine whether the plugin</span></span><br><span class="line">	<span class="comment">// aborted execution due to an error condition</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasError</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ti·∫øp theo ta ph·∫£i c√≥ m·ªôt c√°i main ƒë·ªÉ ch·∫°y logic c·ªßa ·ª©ng d·ª•ng v√† g·ªçi c√°c plugin, ta g·ªçi l√† <code>PluginDemo.java</code> ch·ª©a h√†m main.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PluginDemo</span> </span>&#123;</span><br><span class="line">	<span class="comment">//parameter for plugins</span></span><br><span class="line">	<span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// the directory where we keep the plugin classes</span></span><br><span class="line">	String pluginsDir;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// a list where we keep an initialized object of each plugin class</span></span><br><span class="line">	List plugins;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">		PluginDemo demo = <span class="keyword">new</span> PluginDemo(args);</span><br><span class="line">		demo.getPlugins();</span><br><span class="line">		demo.runPlugins();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PluginDemo (String args[]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (args.length &gt; <span class="number">0</span>)</span><br><span class="line">			count = Integer.parseInt(args[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (args.length &gt; <span class="number">1</span>)</span><br><span class="line">			pluginsDir = args[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			pluginsDir = <span class="string">"plugins"</span>;</span><br><span class="line"></span><br><span class="line">		plugins = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">		System.setSecurityManaghttps:<span class="comment">//analytics.google.com/analytics/web/?authuser=0#croverview/cr-overview/a79213161w118319613p123773431/er(new PluginSecurityManager(pluginsDir));</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">getPlugins</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		File dir = <span class="keyword">new</span> File(System.getProperty(<span class="string">"user.dir"</span>) + File.separator + pluginsDir);</span><br><span class="line">		ClassLoader cl = <span class="keyword">new</span> PluginClassLoader(dir);</span><br><span class="line">		<span class="keyword">if</span> (dir.exists() &amp;&amp; dir.isDirectory()) &#123;</span><br><span class="line">			<span class="comment">// we'll only load classes directly in this directory -</span></span><br><span class="line">			<span class="comment">// no subdirectories, and no classes in packages are recognized</span></span><br><span class="line">			String[] files = dir.list();</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;files.length; i++) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="comment">// only consider files ending in ".class"</span></span><br><span class="line">					<span class="keyword">if</span> (! files[i].endsWith(<span class="string">".class"</span>))</span><br><span class="line">						<span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">					Class c = cl.loadClass(files[i].substring(<span class="number">0</span>, files[i].indexOf(<span class="string">"."</span>)));</span><br><span class="line">					Class[] intf = c.getInterfaces();</span><br><span class="line">					<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;intf.length; j++) &#123;</span><br><span class="line">						<span class="keyword">if</span> (intf[j].getName().equals(<span class="string">"PluginFunction"</span>)) &#123;</span><br><span class="line">							<span class="comment">// the following line assumes that PluginFunction has a no-argument constructor</span></span><br><span class="line">							PluginFunction pf = (PluginFunction) c.newInstance();</span><br><span class="line">							plugins.add(pf);</span><br><span class="line">							<span class="keyword">continue</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">					System.err.println(<span class="string">"File "</span> + files[i] + <span class="string">" does not contain a valid PluginFunction class."</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">runPlugins</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Iterator iter = plugins.iterator();</span><br><span class="line">		<span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">			PluginFunction pf = (PluginFunction) iter.next();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				pf.setParameter(count);</span><br><span class="line">				System.out.print(pf.getPluginName());</span><br><span class="line">				System.out.print(<span class="string">" ( "</span>+count+<span class="string">" ) = "</span>);</span><br><span class="line">				<span class="keyword">if</span> (pf.hasError()) &#123;</span><br><span class="line">					System.out.println(<span class="string">"there was an error during plugin initialization"</span>);</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">int</span> result = pf.getResult();</span><br><span class="line">				<span class="keyword">if</span> (pf.hasError())</span><br><span class="line">					System.out.println(<span class="string">"there was an error during plugin execution"</span>);</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					System.out.println(result);</span><br><span class="line">				count++;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (SecurityException secEx) &#123;</span><br><span class="line">				System.err.println(<span class="string">"plugin '"</span>+pf.getClass().getName()+<span class="string">"' tried to do something illegal"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ta th·∫•y trong h√†m <code>getPlugins</code> c√≥ m·ªôt v√≤ng for ƒë·ªÉ load h·∫øt c√°c class m√† c√≥ interface l√† <code>PluginFunction</code> r·ªìi t·∫°o ra m·ªôt th·ª±c th·ªÉ c·ªßa class ƒë√≥ v√† l∆∞u v√†o m·∫£ng <code>plugins</code>. Sau ƒë√≥ h√†m <code>runPlugins</code> s·∫Ω duy·ªát qua t·∫•t c·∫£ c·∫£c plugins set tham s·ªë ch·∫°y h√†m run c·ªßa t·ª´ng plugin v√† in ra k·∫øt qu·∫£.</p><p>Ngo√†i ra h√†m <code>getPlugins</code> c√≤n c√≥ m·ªôt ƒëi·ªÅu th√∫ v·ªã n·ªØa ch√≠nh l√† d√≤ng setSecurityManager, v√¨ ƒë√¢y l√† c√°c plugins ƒë·ªôc l·∫≠p v·ªõi h·ªá th·ªëng n√™n ta phhair x√©t qu·ªÅn h·∫°n cho n√≥ ch·ª© nh·ª° thanh ni√™n n√†o vui t√≠nh l·∫°i cho c√°i plugin x√≥a h·∫øt h·ªá ƒëi·ªÅu h√†nh th√¨ ch·ªâ bi·∫øt ng·ªìi ƒë·∫•y m√† kh√≥c th√¥i üò≠.</p><p>ƒê√¢y l√† n·ªôi dung file <code>PluginSecurityManager.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* This is a fairly uptight security manager subclass. Classes loaded by</span></span><br><span class="line"><span class="comment">* the PluginClassLoader are highly restricted in what they are allowed to do.</span></span><br><span class="line"><span class="comment">* This is okay, because they're only supposed to calculate some values,</span></span><br><span class="line"><span class="comment">* for which all necessary data is already available to them.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* A SecurityManager consists of various methods that the system calls to</span></span><br><span class="line"><span class="comment">* check whether certain sensitive operations should be allowed. These</span></span><br><span class="line"><span class="comment">* methods can throw a SecurityException to prevent the operation from</span></span><br><span class="line"><span class="comment">* happening. With this SecurityManager, we want to prevent untrusted</span></span><br><span class="line"><span class="comment">* code that was loaded by a class loader from performing those sensitive operations.</span></span><br><span class="line"><span class="comment">* So we use inherited SecurityManager methods to check whether the call is being</span></span><br><span class="line"><span class="comment">* made by an untrusted class. If it is, we throw an exception.</span></span><br><span class="line"><span class="comment">* Otherwise, we simply return, allowing the operation to proceed normally.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PluginSecurityManager</span> <span class="keyword">extends</span> <span class="title">SecurityManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String pluginDir = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	PluginSecurityManager (String dir) &#123;</span><br><span class="line">		pluginDir = dir;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * This is the basic method that tests whether there is a class loaded</span></span><br><span class="line"><span class="comment">	 * by a ClassLoader anywhere on the stack. If so, it means that that</span></span><br><span class="line"><span class="comment">	 * untrusted code is trying to perform some kind of sensitive operation.</span></span><br><span class="line"><span class="comment">	 * We prevent it from performing that operation by throwing an exception.</span></span><br><span class="line"><span class="comment">	 * trusted() is called by most of the check...() methods below.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">trusted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (inClassLoader()) <span class="keyword">throw</span> <span class="keyword">new</span> SecurityException();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * These are all the specific checks that a security manager can</span></span><br><span class="line"><span class="comment">	 * perform. They all just call one of the methods above and throw a</span></span><br><span class="line"><span class="comment">	 * SecurityException if the operation is not allowed. This </span></span><br><span class="line"><span class="comment">	 * SecurityManager subclass is perhaps a little too restrictive. For</span></span><br><span class="line"><span class="comment">	 * example, it doesn't allow loaded code to read *any* system properties,</span></span><br><span class="line"><span class="comment">	 * even though some of them are quite harmless.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkCreateClassLoader</span><span class="params">()</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkAccess</span> <span class="params">(Thread g)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkAccess</span> <span class="params">(ThreadGroup g)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkExit</span> <span class="params">(<span class="keyword">int</span> status)</span> </span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> SecurityException(<span class="string">"Not allowed."</span>); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkExec</span> <span class="params">(String cmd)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkLink</span> <span class="params">(String lib)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkRead</span> <span class="params">(java.io.FileDescriptor fd)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkRead</span> <span class="params">(String file)</span> </span>&#123;</span><br><span class="line"><span class="comment">//		String path = new File(file).getParentFile().getAbsolutePath();</span></span><br><span class="line"><span class="comment">//		if (! path.endsWith(pluginDir))</span></span><br><span class="line">			trusted();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkRead</span> <span class="params">(String file, Object context)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkWrite</span> <span class="params">(java.io.FileDescriptor fd)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkWrite</span> <span class="params">(String file)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkDelete</span> <span class="params">(String file)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkConnect</span> <span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkConnect</span> <span class="params">(String host,<span class="keyword">int</span> port,Object context)</span> </span>&#123;trusted();&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkListen</span> <span class="params">(<span class="keyword">int</span> port)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkAccept</span> <span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkMulticast</span> <span class="params">(java.net.InetAddress maddr)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkMulticast</span> <span class="params">(java.net.InetAddress maddr, <span class="keyword">byte</span> ttl)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkPropertiesAccess</span><span class="params">()</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkPropertyAccess</span> <span class="params">(String key)</span> </span>&#123;</span><br><span class="line"><span class="comment">//		if (! key.equals("user.dir"))</span></span><br><span class="line">			trusted();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkPrintJobAccess</span><span class="params">()</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkSystemClipboardAccess</span><span class="params">()</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkAwtEventQueueAccess</span><span class="params">()</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkSetFactory</span><span class="params">()</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkMemberAccess</span> <span class="params">(Class clazz, <span class="keyword">int</span> which)</span> </span>&#123; trusted(); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkSecurityAccess</span> <span class="params">(String provider)</span> </span>&#123; trusted(); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Loaded code can only load classes from java.* packages */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkPackageAccess</span> <span class="params">(String pkg)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">if</span> (inClassLoader() &amp;&amp; !pkg.startsWith(<span class="string">"java."</span>) &amp;&amp; !pkg.startsWith(<span class="string">"javax."</span>))</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> SecurityException();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Loaded code can't define classes in java.* or sun.* packages */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkPackageDefinition</span> <span class="params">(String pkg)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">if</span> (inClassLoader() &amp;&amp; ((pkg.startsWith(<span class="string">"java."</span>) || pkg.startsWith(<span class="string">"javax."</span>) || pkg.startsWith(<span class="string">"sun."</span>))))</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> SecurityException();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** </span></span><br><span class="line"><span class="comment">	 * This is the one SecurityManager method that is different from the</span></span><br><span class="line"><span class="comment">	 * others. It indicates whether a top-level window should display an</span></span><br><span class="line"><span class="comment">	 * "untrusted" warning. The window is always allowed to be created, so</span></span><br><span class="line"><span class="comment">	 * this method is not normally meant to throw an exception. It should</span></span><br><span class="line"><span class="comment">	 * return true if the window does not need to display the warning, and</span></span><br><span class="line"><span class="comment">	 * false if it does. In this example, however, our text-based Service</span></span><br><span class="line"><span class="comment">	 * classes should never need to create windows, so we will actually</span></span><br><span class="line"><span class="comment">	 * throw an exception to prevent any windows from being opened.</span></span><br><span class="line"><span class="comment">	 **/</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkTopLevelWindow</span> <span class="params">(Object window)</span> </span>&#123; </span><br><span class="line">		trusted();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ngo√†i ra ta c√≤n c·∫ßn 1 c√°i loader ƒë·ªÉ load c√°c plugins ra n·ªØa <code>PluginClassLoader.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * In order to impose tight security restrictions on untrusted classes but</span></span><br><span class="line"><span class="comment">   * not on trusted system classes, we have to be able to distinguish between</span></span><br><span class="line"><span class="comment">   * those types of classes. This is done by keeping track of how the classes</span></span><br><span class="line"><span class="comment">   * are loaded into the system. By definition, any class that the interpreter</span></span><br><span class="line"><span class="comment">   * loads directly from the CLASSPATH is trusted. This means that we can't</span></span><br><span class="line"><span class="comment">   * load untrusted code in that way--we can't load it with Class.forName().</span></span><br><span class="line"><span class="comment">   * Instead, we create a ClassLoader subclass to load the untrusted code.</span></span><br><span class="line"><span class="comment">   * This one loads classes from a specified directory (which should not</span></span><br><span class="line"><span class="comment">   * be part of the CLASSPATH).</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PluginClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** This is the directory from which the classes will be loaded */</span></span><br><span class="line">    File directory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The constructor. Just initialize the directory */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PluginClassLoader</span> <span class="params">(File dir)</span> </span>&#123;</span><br><span class="line">		directory = dir;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** A convenience method that calls the 2-argument form of this method */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Class <span class="title">loadClass</span> <span class="params">(String name)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123; </span><br><span class="line">      <span class="keyword">return</span> loadClass(name, <span class="keyword">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This is one abstract method of ClassLoader that all subclasses must</span></span><br><span class="line"><span class="comment">     * define. Its job is to load an array of bytes from somewhere and to</span></span><br><span class="line"><span class="comment">     * pass them to defineClass(). If the resolve argument is true, it must</span></span><br><span class="line"><span class="comment">     * also call resolveClass(), which will do things like verify the presence</span></span><br><span class="line"><span class="comment">     * of the superclass. Because of this second step, this method may be called to</span></span><br><span class="line"><span class="comment">     * load superclasses that are system classes, and it must take this into account.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Class <span class="title">loadClass</span> <span class="params">(String classname, <span class="keyword">boolean</span> resolve)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// Our ClassLoader superclass has a built-in cache of classes it has</span></span><br><span class="line">        <span class="comment">// already loaded. So, first check the cache.</span></span><br><span class="line">        Class c = findLoadedClass(classname);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// After this method loads a class, it will be called again to</span></span><br><span class="line">        <span class="comment">// load the superclasses. Since these may be system classes, we've</span></span><br><span class="line">        <span class="comment">// got to be able to load those too. So try to load the class as</span></span><br><span class="line">        <span class="comment">// a system class (i.e. from the CLASSPATH) and ignore any errors</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123; c = findSystemClass(classname); &#125;</span><br><span class="line">          <span class="keyword">catch</span> (Exception ex) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If the class wasn't found by either of the above attempts, then</span></span><br><span class="line">        <span class="comment">// try to load it from a file in (or beneath) the directory</span></span><br><span class="line">        <span class="comment">// specified when this ClassLoader object was created. Form the</span></span><br><span class="line">        <span class="comment">// filename by replacing all dots in the class name with</span></span><br><span class="line">        <span class="comment">// (platform-independent) file separators and by adding the ".class" extension.</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">// Figure out the filename</span></span><br><span class="line">          String filename = classname.replace(<span class="string">'.'</span>,File.separatorChar)+<span class="string">".class"</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Create a File object. Interpret the filename relative to the</span></span><br><span class="line">          <span class="comment">// directory specified for this ClassLoader.</span></span><br><span class="line">          File f = <span class="keyword">new</span> File(directory, filename);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Get the length of the class file, allocate an array of bytes for</span></span><br><span class="line">          <span class="comment">// it, and read it in all at once.</span></span><br><span class="line">          <span class="keyword">int</span> length = (<span class="keyword">int</span>) f.length();</span><br><span class="line">          <span class="keyword">byte</span>[] classbytes = <span class="keyword">new</span> <span class="keyword">byte</span>[length];</span><br><span class="line">          DataInputStream in = <span class="keyword">new</span> DataInputStream(<span class="keyword">new</span> FileInputStream(f));</span><br><span class="line">          in.readFully(classbytes);</span><br><span class="line">          in.close();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Now call an inherited method to convert those bytes into a Class</span></span><br><span class="line">          c = defineClass(classname, classbytes, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If the resolve argument is true, call the inherited resolveClass method.</span></span><br><span class="line">        <span class="keyword">if</span> (resolve) resolveClass(c);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// And we're done. Return the Class object we've loaded.</span></span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// If anything goes wrong, throw a ClassNotFoundException error</span></span><br><span class="line">      <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(ex.toString()); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Haiz, v·ªÅ c∆° b·∫£n h·ªá th·ªëng setup th·∫ø l√† xong, ti·∫øp theo ta s·∫Ω c·∫ßn 1 2 c√°i plugins ƒë·ªÉ test th·ªß xem n√≥ c√≥ ch·∫°y ·ªïn kh√¥ng, ta s·∫Ω ƒë·∫∑t c√°c file n√†y trong th∆∞ m·ª•c <code>plugins</code>.</p><p><code>Square.java</code> t√¨nh b√¨nh ph∆∞ng c·ªßa tham s·ªë:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This plugin squares its argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">implements</span> <span class="title">PluginFunction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> parameter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span> <span class="params">(<span class="keyword">int</span> param)</span> </span>&#123;</span><br><span class="line">		parameter = param;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> parameter * parameter;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPluginName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Square"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// yes, this operation can fail, but we are going to ignore this here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasError</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>PlusOne.java</code> c·ªông 1 ƒë∆°n v·ªã v√†o tham s·ªë:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This plugin adds one to the parameter.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlusOne</span> <span class="keyword">implements</span> <span class="title">PluginFunction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> parameter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span> <span class="params">(<span class="keyword">int</span> param)</span> </span>&#123;</span><br><span class="line">		parameter = param;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> parameter + <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPluginName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"PlusOne"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// yes, ths operation can fail, but we are going to ignore this here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasError</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>TryToExit.java</code> th·ª≠ cho thanh ni√™n n√†y l·∫°m qu·ªÅn t√Ω xem c√≥ ƒë∆∞·ªçc kh√¥ng, trong <code>PluginSecurityManager</code> ta ƒë√£ set kh√¥ng cho plugin tho√°t ch∆∞∆°ng tr√¨nh r·ªìi.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This plugin tries to call System.exit(), which the SecurityManager doesn't allow.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TryToExit</span> <span class="keyword">implements</span> <span class="title">PluginFunction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span> <span class="params">(<span class="keyword">int</span> param)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// this function doesn't care about its parameter,</span></span><br><span class="line">		<span class="comment">// so it doesn't even store it for later use</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// The next line will be caught by the SecurityManagers 'checkExit' method.</span></span><br><span class="line">		System.exit(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPluginName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"TryToExit"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// yes, this operation can fail, but we are going to ignore this here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasError</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ti·∫øp theo l√† d·ªãch v√† ch·∫°y th·ª≠, n·∫øu kh√¥ng c√≥ g√¨ sai th√¨ s·∫Ω thu ƒë∆∞·ª£c output nh∆∞ n√†y, m√¨nh d√πng java 8 n√™n c√≥ phun ra m·∫•y c√°i Note, th√¥i k·ªá d√π sao n√≥ v·∫´n ch·∫°y ƒë∆∞·ª£c üòÑ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">minh@MINH-PC:~/Desktop/Plugin$ javac *.java</span><br><span class="line">Note: PluginSecurityManager.java uses or overrides a deprecated API.</span><br><span class="line">Note: Recompile with -Xlint:deprecation for details.</span><br><span class="line">Note: PluginDemo.java uses unchecked or unsafe operations.</span><br><span class="line">Note: Recompile with -Xlint:unchecked for details.</span><br><span class="line">minh@MINH-PC:~/Desktop/Plugin$ java PluginDemo</span><br><span class="line">TryToExit ( 1 ) = plugin 'TryToExit' tried to do something illegal</span><br><span class="line">PlusOne ( 1 ) = 2</span><br><span class="line">Square ( 2 ) = 4</span><br></pre></td></tr></table></figure><p>Th·ª±c ra toppic n√†y c√≤n th√™m v·∫•n ƒë·ªÅ n·ªØa l√† build ra file jar v√† c√†i ƒë·∫∑t plugin b·∫±ng xml nh∆∞ng t·∫°p th·ªùi th·∫ø n√†y ƒë√£. xin h·∫πn ae m·ªôt d·ªãp kh√°c.</p><p>Xin ch√¢n th√†nh c·∫£m ∆°n b·ªô code m·∫´u c·ªßa <a href="http://www.javaranch.com/contact.jsp#UlfDittmer" target="_blank" rel="noopener">@Ulf Dittmer</a>, c√°c b·∫°n code th·ªÉ <a href="Plugin.zip">download</a> code d·ªÉ tham kh·∫£o.</p><p>Ph√πu‚Ä¶ c·∫£m ∆°n ae ƒë√£ theo d√µi ƒë·∫øn t·∫≠n ƒë√¢y, b√†i ƒë√£ d√†i tay quay ƒë√£ m·ªèi m√¨nh xin ph√©p d·ª´ng ph√≠m t·∫°i ƒë√¢y. ch√∫c ae cu·ªëi tu·∫ßn vui v·∫ª.<br>xin ch√†o th√¢n √°i v√† qu·∫øt th·∫Øng.</p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">TAGGED IN</span><br><a class="tag tag--primary tag--small t-link" href="/tags/design-pattern/">design pattern</a> <a class="tag tag--primary tag--small t-link" href="/tags/java/">java</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/07/Flux-la-cai-quai-gi-nhi/" data-tooltip="Flux l√† c√°i qu√°i g√¨ nh·ªâ" aria-label="PREVIOUS: Flux l√† c√°i qu√°i g√¨ nh·ªâ"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/06/BOOK-ca-phe-cung-Tony-ly-ca-phe-dam-da-huong-vi-cuoc-song/" data-tooltip="C√† ph√™ c√πng Tony - ly c√† ph√™ ƒë·∫≠m ƒë√†  h∆∞∆°ng v·ªã cu·ªôc s·ªëng" aria-label="NEXT: C√† ph√™ c√πng Tony - ly c√† ph√™ ƒë·∫≠m ƒë√†  h∆∞∆°ng v·ªã cu·ªôc s·ªëng"><span class="hide-xs hide-sm text-small icon-mr">NEXT</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" title="Share on Facebook" aria-label="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" title="Share on Twitter" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" title="Share on Google+" aria-label="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#" aria-label="Back to top"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div></article><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2019 Minh Luc. All Rights Reserved.</span></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="4"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/07/Flux-la-cai-quai-gi-nhi/" data-tooltip="Flux l√† c√°i qu√°i g√¨ nh·ªâ" aria-label="PREVIOUS: Flux l√† c√°i qu√°i g√¨ nh·ªâ"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/06/BOOK-ca-phe-cung-Tony-ly-ca-phe-dam-da-huong-vi-cuoc-song/" data-tooltip="C√† ph√™ c√πng Tony - ly c√† ph√™ ƒë·∫≠m ƒë√†  h∆∞∆°ng v·ªã cu·ªôc s·ªëng" aria-label="NEXT: C√† ph√™ c√πng Tony - ly c√† ph√™ ƒë·∫≠m ƒë√†  h∆∞∆°ng v·ªã cu·ªôc s·ªëng"><span class="hide-xs hide-sm text-small icon-mr">NEXT</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" title="Share on Facebook" aria-label="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" title="Share on Twitter" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" title="Share on Google+" aria-label="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#" aria-label="Back to top"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div><div id="share-options-bar" class="share-options-bar" data-behavior="4"><i id="btn-close-shareoptions" class="fa fa-times"></i><ul class="share-options"><li class="share-option"><a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" aria-label="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" aria-label="Share on Twitter"><i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="https://plus.google.com/share?url=/2016/08/06/viet-mot-chuong-trinh-cho-phep-cai-plugin-trong-java-nhu-the-nao/" aria-label="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span></a></li></ul></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="https://www.buildabear.com/dw/image/v2/BBNG_PRD/on/demandware.static/-/Sites-buildabear-master/default/dwdfa7c1cf/27618_27630_25342_24630x.jpg?sw=600&amp;sh=600&amp;sm=fit&amp;q=70" alt="Author&#39;s picture"><h4 id="about-card-name">Minh Luc</h4><div id="about-card-bio"><p>author.bio</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>author.job</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>Hanoi, Vietnam</div></div></div><div id="cover" style="background-image:url(/assets/images/cover-v1.2.0.jpg)"></div><script src="/assets/js/script-v5hftjqfholivslt8zs7notwx80qctz8sotsfl1pxlrg8swcj6ncpoq2rqih.min.js"></script></body></html>